{"version":3,"file":"index.js","sources":["../src/utils.js","../src/tracker.js","../src/index.js"],"sourcesContent":["import extend from 'extend';\n\nexport const getEvent = (event) => {\n    event = event || window.event;\n    if (!event) {\n        return event;\n    }\n    if (!event.target) {\n        event.target = event.srcElement;\n    }\n    if (!event.currentTarget) {\n        event.currentTarget = event.srcElement;\n    }\n    return event;\n}\n\nexport const getEventListenerMethod = () => {\n    let addMethod = 'addEventListener', removeMethod = 'removeEventListener', prefix = '';\n    if (!window.addEventListener) {\n        addMethod = 'attachEvent';\n        removeMethod = 'detachEvent';\n        prefix = 'on';\n    }\n    return {\n        addMethod,\n        removeMethod,\n        prefix,\n    }\n}\n\nexport const getBoundingClientRect = (element) => {\n    const rect = element.getBoundingClientRect();\n    const width = rect.width || rect.right - rect.left;\n    const heigth = rect.heigth || rect.bottom - rect.top;\n    return extend({}, rect, {\n        width,\n        heigth,\n    });\n}\n\nexport const stringify = (obj) => {\n    let params = [];\n    for (let key in obj) {\n        params.push(`${key}=${obj[key]}`);\n    }\n    return params.join('&');\n}\n\nexport function getDomPath(element, useClass = false) {\n    if (!(element instanceof HTMLElement)) {\n        console.warn('input is not a HTML element!');\n        return '';\n    }\n    let domPath = [];\n    let elem = element;\n    while(elem) {\n        let domDesc = getDomDesc(elem, useClass);\n        if (!domDesc) {\n            break;\n        }\n        domPath.unshift(domDesc);\n        if (querySelector(domPath.join('>')) === element || domDesc.indexOf('body') >= 0) {\n            break;\n        }\n        domPath.shift();\n        const children = elem.parentNode.children;\n        if (children.length > 1) {\n            for (let i = 0; i < children.length; i++) {\n                if (children[i] === elem) {\n                    domDesc += `:nth-child(${i + 1})`;\n                    break;\n                }\n            }\n        }\n        domPath.unshift(domDesc);\n        if (querySelector(domPath.join('>')) === element) {\n            break;\n        }\n        elem = elem.parentNode;\n    }\n    return domPath.join('>');\n}\n\nexport function getDomDesc(element, useClass = false) {\n    const domDesc = [];\n    if (!element || !element.tagName) {\n        return '';\n    }\n    if (element.id) {\n        return `#${element.id}`;\n    }\n    domDesc.push(element.tagName.toLowerCase());\n    if (useClass) {\n        const className = element.className;\n        if (className && typeof className === 'string') {\n            const classes = className.split(/\\s+/);\n            domDesc.push(`.${classes.join('.')}`);\n        }\n    }\n    if (element.name) {\n        domDesc.push(`[name=${element.name}]`);\n    }\n    return domDesc.join('');\n}\n\nexport function querySelector(queryString) {\n    return document.getElementById(queryString) || document.getElementsByName(queryString)[0] || document.querySelector(queryString);\n}\n","import extend from 'extend';\nimport {\n    getEvent,\n    getEventListenerMethod,\n    getBoundingClientRect,\n    stringify,\n    getDomPath,\n} from './utils'\n\nconst DefaultOptions = {\n    useClass: false, \n    per: 0.01,\n    events: ['click'],\n};\n\nclass Tracker {\n    constructor() {\n        this._isInstall = false;\n        this._options = {};\n    }\n\n    config(options = {}) {\n        options = extend(true, {}, DefaultOptions, options);\n        options.event = DefaultOptions.event; \n        this._options = options;\n        return this;\n    }\n\n    _captureEvents() {\n        const self = this;\n        const events = this._options.events;\n        const eventMethodObj = getEventListenerMethod();\n        for (let i = 0, j = events.length; i < j; i++) {\n            let eventName = events[i];\n            document.body[eventMethodObj.addMethod](eventMethodObj.prefix + eventName, function (event) {\n                const eventFix = getEvent(event);\n                if (!eventFix) {\n                    return;\n                }\n                self._handleEvent(eventFix);\n            }, false)\n        }\n    }\n\n    _handleEvent(event) {\n        const per = parseFloat(this._options.per);\n        if (!this.hit(per)) {\n            return;\n        }\n        const domPath = getDomPath(event.target, this._options.useClass);\n        const rect = getBoundingClientRect(event.target);\n        if (rect.width == 0 || rect.height == 0) {\n            return;\n        }\n        let t = document.documentElement || document.body.parentNode;\n        const scrollX = (t && typeof t.scrollLeft == 'number' ? t : document.body).scrollLeft;\n        const scrollY = (t && typeof t.scrollTop == 'number' ? t : document.body).scrollTop;\n        const pageX = event.pageX || event.clientX + scrollX;\n        const pageY = event.pageY || event.clientY + scrollY;\n        const data = {\n            domPath: encodeURIComponent(domPath), \n            trackingType: event.type,\n            offsetX: ((pageX - rect.left - scrollX) / rect.width).toFixed(6), \n            offsetY: ((pageY - rect.top - scrollY) / rect.height).toFixed(6),\n        };\n        this.send(data);\n    }\n\n    send(data = {}) {\n        console.log('data', data);\n        const image = new Image(1, 1);\n        image.onload = function() {\n            image = null;\n        };\n        image.src = `/?${stringify(data)}`;\n    }\n\n    hit(per = 0.01) {\n        return Math.random() < per;\n    }\n\n    install() {\n        if (this._isInstall) {\n            return this;\n        }\n        this._captureEvents();\n        this._isInstall = true;\n        return this;\n    }\n}\n\nexport default Tracker;","import Tracker from './tracker';\n\nconst tracker = new Tracker();\n\nexport default tracker;"],"names":["getEvent","event","window","target","srcElement","currentTarget","getEventListenerMethod","addMethod","removeMethod","prefix","addEventListener","getBoundingClientRect","element","rect","width","right","left","heigth","bottom","top","extend","stringify","obj","params","key","push","join","getDomPath","useClass","HTMLElement","console","warn","domPath","elem","domDesc","getDomDesc","unshift","querySelector","indexOf","shift","children","parentNode","length","i","tagName","id","toLowerCase","className","classes","split","name","queryString","document","getElementById","getElementsByName","DefaultOptions","per","events","Tracker","_isInstall","_options","options","self","eventMethodObj","j","eventName","body","eventFix","_handleEvent","parseFloat","hit","height","t","documentElement","scrollX","scrollLeft","scrollY","scrollTop","pageX","clientX","pageY","clientY","data","encodeURIComponent","trackingType","type","offsetX","toFixed","offsetY","send","log","image","Image","onload","src","Math","random","_captureEvents","tracker"],"mappings":";;;;;;;;;;;AAEO,IAAMA,QAAQ,GAAG,SAAXA,QAAW,CAACC,KAAD,EAAW;EAC/BA,KAAK,GAAGA,KAAK,IAAIC,MAAM,CAACD,KAAxB;;MACI,CAACA,KAAL,EAAY;WACDA,KAAP;;;MAEA,CAACA,KAAK,CAACE,MAAX,EAAmB;IACfF,KAAK,CAACE,MAAN,GAAeF,KAAK,CAACG,UAArB;;;MAEA,CAACH,KAAK,CAACI,aAAX,EAA0B;IACtBJ,KAAK,CAACI,aAAN,GAAsBJ,KAAK,CAACG,UAA5B;;;SAEGH,KAAP;CAXG;AAcA,IAAMK,sBAAsB,GAAG,SAAzBA,sBAAyB,GAAM;MACpCC,SAAS,GAAG,kBAAhB;MAAoCC,YAAY,GAAG,qBAAnD;MAA0EC,MAAM,GAAG,EAAnF;;MACI,CAACP,MAAM,CAACQ,gBAAZ,EAA8B;IAC1BH,SAAS,GAAG,aAAZ;IACAC,YAAY,GAAG,aAAf;IACAC,MAAM,GAAG,IAAT;;;SAEG;IACHF,SAAS,EAATA,SADG;IAEHC,YAAY,EAAZA,YAFG;IAGHC,MAAM,EAANA;GAHJ;CAPG;AAcA,IAAME,qBAAqB,GAAG,SAAxBA,qBAAwB,CAACC,OAAD,EAAa;MACxCC,IAAI,GAAGD,OAAO,CAACD,qBAAR,EAAb;MACMG,KAAK,GAAGD,IAAI,CAACC,KAAL,IAAcD,IAAI,CAACE,KAAL,GAAaF,IAAI,CAACG,IAA9C;MACMC,MAAM,GAAGJ,IAAI,CAACI,MAAL,IAAeJ,IAAI,CAACK,MAAL,GAAcL,IAAI,CAACM,GAAjD;SACOC,MAAM,CAAC,EAAD,EAAKP,IAAL,EAAW;IACpBC,KAAK,EAALA,KADoB;IAEpBG,MAAM,EAANA;GAFS,CAAb;CAJG;AAUA,IAAMI,SAAS,GAAG,SAAZA,SAAY,CAACC,GAAD,EAAS;MAC1BC,MAAM,GAAG,EAAb;;OACK,IAAIC,GAAT,IAAgBF,GAAhB,EAAqB;IACjBC,MAAM,CAACE,IAAP,WAAeD,GAAf,cAAsBF,GAAG,CAACE,GAAD,CAAzB;;;SAEGD,MAAM,CAACG,IAAP,CAAY,GAAZ,CAAP;CALG;AAQA,SAASC,UAAT,CAAoBf,OAApB,EAA+C;MAAlBgB,QAAkB,uEAAP,KAAO;;MAC9C,EAAEhB,OAAO,YAAYiB,WAArB,CAAJ,EAAuC;IACnCC,OAAO,CAACC,IAAR,CAAa,8BAAb;WACO,EAAP;;;MAEAC,OAAO,GAAG,EAAd;MACIC,IAAI,GAAGrB,OAAX;;SACMqB,IAAN,EAAY;QACJC,OAAO,GAAGC,UAAU,CAACF,IAAD,EAAOL,QAAP,CAAxB;;QACI,CAACM,OAAL,EAAc;;;;IAGdF,OAAO,CAACI,OAAR,CAAgBF,OAAhB;;QACIG,aAAa,CAACL,OAAO,CAACN,IAAR,CAAa,GAAb,CAAD,CAAb,KAAqCd,OAArC,IAAgDsB,OAAO,CAACI,OAAR,CAAgB,MAAhB,KAA2B,CAA/E,EAAkF;;;;IAGlFN,OAAO,CAACO,KAAR;QACMC,QAAQ,GAAGP,IAAI,CAACQ,UAAL,CAAgBD,QAAjC;;QACIA,QAAQ,CAACE,MAAT,GAAkB,CAAtB,EAAyB;WAChB,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,QAAQ,CAACE,MAA7B,EAAqCC,CAAC,EAAtC,EAA0C;YAClCH,QAAQ,CAACG,CAAD,CAAR,KAAgBV,IAApB,EAA0B;UACtBC,OAAO,yBAAkBS,CAAC,GAAG,CAAtB,MAAP;;;;;;IAKZX,OAAO,CAACI,OAAR,CAAgBF,OAAhB;;QACIG,aAAa,CAACL,OAAO,CAACN,IAAR,CAAa,GAAb,CAAD,CAAb,KAAqCd,OAAzC,EAAkD;;;;IAGlDqB,IAAI,GAAGA,IAAI,CAACQ,UAAZ;;;SAEGT,OAAO,CAACN,IAAR,CAAa,GAAb,CAAP;;AAGG,SAASS,UAAT,CAAoBvB,OAApB,EAA+C;MAAlBgB,QAAkB,uEAAP,KAAO;MAC5CM,OAAO,GAAG,EAAhB;;MACI,CAACtB,OAAD,IAAY,CAACA,OAAO,CAACgC,OAAzB,EAAkC;WACvB,EAAP;;;MAEAhC,OAAO,CAACiC,EAAZ,EAAgB;sBACDjC,OAAO,CAACiC,EAAnB;;;EAEJX,OAAO,CAACT,IAAR,CAAab,OAAO,CAACgC,OAAR,CAAgBE,WAAhB,EAAb;;MACIlB,QAAJ,EAAc;QACJmB,SAAS,GAAGnC,OAAO,CAACmC,SAA1B;;QACIA,SAAS,IAAI,OAAOA,SAAP,KAAqB,QAAtC,EAAgD;UACtCC,OAAO,GAAGD,SAAS,CAACE,KAAV,CAAgB,KAAhB,CAAhB;MACAf,OAAO,CAACT,IAAR,YAAiBuB,OAAO,CAACtB,IAAR,CAAa,GAAb,CAAjB;;;;MAGJd,OAAO,CAACsC,IAAZ,EAAkB;IACdhB,OAAO,CAACT,IAAR,iBAAsBb,OAAO,CAACsC,IAA9B;;;SAEGhB,OAAO,CAACR,IAAR,CAAa,EAAb,CAAP;;AAGG,SAASW,aAAT,CAAuBc,WAAvB,EAAoC;SAChCC,QAAQ,CAACC,cAAT,CAAwBF,WAAxB,KAAwCC,QAAQ,CAACE,iBAAT,CAA2BH,WAA3B,EAAwC,CAAxC,CAAxC,IAAsFC,QAAQ,CAACf,aAAT,CAAuBc,WAAvB,CAA7F;;;ICjGEI,cAAc,GAAG;EACnB3B,QAAQ,EAAE,KADS;EAEnB4B,GAAG,EAAE,IAFc;EAGnBC,MAAM,EAAE,CAAC,OAAD;CAHZ;;IAMMC;;;qBACY;;;SACLC,UAAL,GAAkB,KAAlB;SACKC,QAAL,GAAgB,EAAhB;;;;;6BAGiB;UAAdC,OAAc,uEAAJ,EAAI;MACjBA,OAAO,GAAGzC,MAAM,CAAC,IAAD,EAAO,EAAP,EAAWmC,cAAX,EAA2BM,OAA3B,CAAhB;MACAA,OAAO,CAAC5D,KAAR,GAAgBsD,cAAc,CAACtD,KAA/B;WACK2D,QAAL,GAAgBC,OAAhB;aACO,IAAP;;;;qCAGa;UACPC,IAAI,GAAG,IAAb;UACML,MAAM,GAAG,KAAKG,QAAL,CAAcH,MAA7B;UACMM,cAAc,GAAGzD,sBAAsB,EAA7C;;WACK,IAAIqC,CAAC,GAAG,CAAR,EAAWqB,CAAC,GAAGP,MAAM,CAACf,MAA3B,EAAmCC,CAAC,GAAGqB,CAAvC,EAA0CrB,CAAC,EAA3C,EAA+C;YACvCsB,SAAS,GAAGR,MAAM,CAACd,CAAD,CAAtB;QACAS,QAAQ,CAACc,IAAT,CAAcH,cAAc,CAACxD,SAA7B,EAAwCwD,cAAc,CAACtD,MAAf,GAAwBwD,SAAhE,EAA2E,UAAUhE,KAAV,EAAiB;cAClFkE,QAAQ,GAAGnE,QAAQ,CAACC,KAAD,CAAzB;;cACI,CAACkE,QAAL,EAAe;;;;UAGfL,IAAI,CAACM,YAAL,CAAkBD,QAAlB;SALJ,EAMG,KANH;;;;;iCAUKlE,OAAO;UACVuD,GAAG,GAAGa,UAAU,CAAC,KAAKT,QAAL,CAAcJ,GAAf,CAAtB;;UACI,CAAC,KAAKc,GAAL,CAASd,GAAT,CAAL,EAAoB;;;;UAGdxB,OAAO,GAAGL,UAAU,CAAC1B,KAAK,CAACE,MAAP,EAAe,KAAKyD,QAAL,CAAchC,QAA7B,CAA1B;UACMf,IAAI,GAAGF,qBAAqB,CAACV,KAAK,CAACE,MAAP,CAAlC;;UACIU,IAAI,CAACC,KAAL,IAAc,CAAd,IAAmBD,IAAI,CAAC0D,MAAL,IAAe,CAAtC,EAAyC;;;;UAGrCC,CAAC,GAAGpB,QAAQ,CAACqB,eAAT,IAA4BrB,QAAQ,CAACc,IAAT,CAAczB,UAAlD;UACMiC,OAAO,GAAG,CAACF,CAAC,IAAI,OAAOA,CAAC,CAACG,UAAT,IAAuB,QAA5B,GAAuCH,CAAvC,GAA2CpB,QAAQ,CAACc,IAArD,EAA2DS,UAA3E;UACMC,OAAO,GAAG,CAACJ,CAAC,IAAI,OAAOA,CAAC,CAACK,SAAT,IAAsB,QAA3B,GAAsCL,CAAtC,GAA0CpB,QAAQ,CAACc,IAApD,EAA0DW,SAA1E;UACMC,KAAK,GAAG7E,KAAK,CAAC6E,KAAN,IAAe7E,KAAK,CAAC8E,OAAN,GAAgBL,OAA7C;UACMM,KAAK,GAAG/E,KAAK,CAAC+E,KAAN,IAAe/E,KAAK,CAACgF,OAAN,GAAgBL,OAA7C;UACMM,IAAI,GAAG;QACTlD,OAAO,EAAEmD,kBAAkB,CAACnD,OAAD,CADlB;QAEToD,YAAY,EAAEnF,KAAK,CAACoF,IAFX;QAGTC,OAAO,EAAE,CAAC,CAACR,KAAK,GAAGjE,IAAI,CAACG,IAAb,GAAoB0D,OAArB,IAAgC7D,IAAI,CAACC,KAAtC,EAA6CyE,OAA7C,CAAqD,CAArD,CAHA;QAITC,OAAO,EAAE,CAAC,CAACR,KAAK,GAAGnE,IAAI,CAACM,GAAb,GAAmByD,OAApB,IAA+B/D,IAAI,CAAC0D,MAArC,EAA6CgB,OAA7C,CAAqD,CAArD;OAJb;WAMKE,IAAL,CAAUP,IAAV;;;;2BAGY;UAAXA,IAAW,uEAAJ,EAAI;MACZpD,OAAO,CAAC4D,GAAR,CAAY,MAAZ,EAAoBR,IAApB;UACMS,KAAK,GAAG,IAAIC,KAAJ,CAAU,CAAV,EAAa,CAAb,CAAd;;MACAD,KAAK,CAACE,MAAN,GAAe,YAAW;QACtBF,KAAK,6BAAG,IAAH,CAAL;OADJ;;MAGAA,KAAK,CAACG,GAAN,eAAiBzE,SAAS,CAAC6D,IAAD,CAA1B;;;;0BAGY;UAAZ1B,GAAY,uEAAN,IAAM;aACLuC,IAAI,CAACC,MAAL,KAAgBxC,GAAvB;;;;8BAGM;UACF,KAAKG,UAAT,EAAqB;eACV,IAAP;;;WAECsC,cAAL;;WACKtC,UAAL,GAAkB,IAAlB;aACO,IAAP;;;;;;;ACrFR,IAAMuC,OAAO,GAAG,IAAIxC,OAAJ,EAAhB;;"}