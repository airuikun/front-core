{"version":3,"file":"tracker.min.js","sources":["../node_modules/@babel/runtime/helpers/readOnlyError.js","../node_modules/@babel/runtime/helpers/classCallCheck.js","../node_modules/@babel/runtime/helpers/createClass.js","../node_modules/extend/index.js","../src/utils.js","../src/tracker.js","../src/index.js"],"sourcesContent":["function _readOnlyError(name) {\n  throw new Error(\"\\\"\" + name + \"\\\" is read-only\");\n}\n\nmodule.exports = _readOnlyError;","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","'use strict';\n\nvar hasOwn = Object.prototype.hasOwnProperty;\nvar toStr = Object.prototype.toString;\nvar defineProperty = Object.defineProperty;\nvar gOPD = Object.getOwnPropertyDescriptor;\n\nvar isArray = function isArray(arr) {\n\tif (typeof Array.isArray === 'function') {\n\t\treturn Array.isArray(arr);\n\t}\n\n\treturn toStr.call(arr) === '[object Array]';\n};\n\nvar isPlainObject = function isPlainObject(obj) {\n\tif (!obj || toStr.call(obj) !== '[object Object]') {\n\t\treturn false;\n\t}\n\n\tvar hasOwnConstructor = hasOwn.call(obj, 'constructor');\n\tvar hasIsPrototypeOf = obj.constructor && obj.constructor.prototype && hasOwn.call(obj.constructor.prototype, 'isPrototypeOf');\n\t// Not own constructor property must be Object\n\tif (obj.constructor && !hasOwnConstructor && !hasIsPrototypeOf) {\n\t\treturn false;\n\t}\n\n\t// Own properties are enumerated firstly, so to speed up,\n\t// if last one is own, then all properties are own.\n\tvar key;\n\tfor (key in obj) { /**/ }\n\n\treturn typeof key === 'undefined' || hasOwn.call(obj, key);\n};\n\n// If name is '__proto__', and Object.defineProperty is available, define __proto__ as an own property on target\nvar setProperty = function setProperty(target, options) {\n\tif (defineProperty && options.name === '__proto__') {\n\t\tdefineProperty(target, options.name, {\n\t\t\tenumerable: true,\n\t\t\tconfigurable: true,\n\t\t\tvalue: options.newValue,\n\t\t\twritable: true\n\t\t});\n\t} else {\n\t\ttarget[options.name] = options.newValue;\n\t}\n};\n\n// Return undefined instead of __proto__ if '__proto__' is not an own property\nvar getProperty = function getProperty(obj, name) {\n\tif (name === '__proto__') {\n\t\tif (!hasOwn.call(obj, name)) {\n\t\t\treturn void 0;\n\t\t} else if (gOPD) {\n\t\t\t// In early versions of node, obj['__proto__'] is buggy when obj has\n\t\t\t// __proto__ as an own property. Object.getOwnPropertyDescriptor() works.\n\t\t\treturn gOPD(obj, name).value;\n\t\t}\n\t}\n\n\treturn obj[name];\n};\n\nmodule.exports = function extend() {\n\tvar options, name, src, copy, copyIsArray, clone;\n\tvar target = arguments[0];\n\tvar i = 1;\n\tvar length = arguments.length;\n\tvar deep = false;\n\n\t// Handle a deep copy situation\n\tif (typeof target === 'boolean') {\n\t\tdeep = target;\n\t\ttarget = arguments[1] || {};\n\t\t// skip the boolean and the target\n\t\ti = 2;\n\t}\n\tif (target == null || (typeof target !== 'object' && typeof target !== 'function')) {\n\t\ttarget = {};\n\t}\n\n\tfor (; i < length; ++i) {\n\t\toptions = arguments[i];\n\t\t// Only deal with non-null/undefined values\n\t\tif (options != null) {\n\t\t\t// Extend the base object\n\t\t\tfor (name in options) {\n\t\t\t\tsrc = getProperty(target, name);\n\t\t\t\tcopy = getProperty(options, name);\n\n\t\t\t\t// Prevent never-ending loop\n\t\t\t\tif (target !== copy) {\n\t\t\t\t\t// Recurse if we're merging plain objects or arrays\n\t\t\t\t\tif (deep && copy && (isPlainObject(copy) || (copyIsArray = isArray(copy)))) {\n\t\t\t\t\t\tif (copyIsArray) {\n\t\t\t\t\t\t\tcopyIsArray = false;\n\t\t\t\t\t\t\tclone = src && isArray(src) ? src : [];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tclone = src && isPlainObject(src) ? src : {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Never move original objects, clone them\n\t\t\t\t\t\tsetProperty(target, { name: name, newValue: extend(deep, clone, copy) });\n\n\t\t\t\t\t// Don't bring in undefined values\n\t\t\t\t\t} else if (typeof copy !== 'undefined') {\n\t\t\t\t\t\tsetProperty(target, { name: name, newValue: copy });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Return the modified object\n\treturn target;\n};\n","import extend from 'extend';\n\nexport const getEvent = (event) => {\n    event = event || window.event;\n    if (!event) {\n        return event;\n    }\n    if (!event.target) {\n        event.target = event.srcElement;\n    }\n    if (!event.currentTarget) {\n        event.currentTarget = event.srcElement;\n    }\n    return event;\n}\n\nexport const getEventListenerMethod = () => {\n    let addMethod = 'addEventListener', removeMethod = 'removeEventListener', prefix = '';\n    if (!window.addEventListener) {\n        addMethod = 'attachEvent';\n        removeMethod = 'detachEvent';\n        prefix = 'on';\n    }\n    return {\n        addMethod,\n        removeMethod,\n        prefix,\n    }\n}\n\nexport const getBoundingClientRect = (element) => {\n    const rect = element.getBoundingClientRect();\n    const width = rect.width || rect.right - rect.left;\n    const heigth = rect.heigth || rect.bottom - rect.top;\n    return extend({}, rect, {\n        width,\n        heigth,\n    });\n}\n\nexport const stringify = (obj) => {\n    let params = [];\n    for (let key in obj) {\n        params.push(`${key}=${obj[key]}`);\n    }\n    return params.join('&');\n}\n\nexport function getDomPath(element, useClass = false) {\n    if (!(element instanceof HTMLElement)) {\n        console.warn('input is not a HTML element!');\n        return '';\n    }\n    let domPath = [];\n    let elem = element;\n    while(elem) {\n        let domDesc = getDomDesc(elem, useClass);\n        if (!domDesc) {\n            break;\n        }\n        domPath.unshift(domDesc);\n        if (querySelector(domPath.join('>')) === element || domDesc.indexOf('body') >= 0) {\n            break;\n        }\n        domPath.shift();\n        const children = elem.parentNode.children;\n        if (children.length > 1) {\n            for (let i = 0; i < children.length; i++) {\n                if (children[i] === elem) {\n                    domDesc += `:nth-child(${i + 1})`;\n                    break;\n                }\n            }\n        }\n        domPath.unshift(domDesc);\n        if (querySelector(domPath.join('>')) === element) {\n            break;\n        }\n        elem = elem.parentNode;\n    }\n    return domPath.join('>');\n}\n\nexport function getDomDesc(element, useClass = false) {\n    const domDesc = [];\n    if (!element || !element.tagName) {\n        return '';\n    }\n    if (element.id) {\n        return `#${element.id}`;\n    }\n    domDesc.push(element.tagName.toLowerCase());\n    if (useClass) {\n        const className = element.className;\n        if (className && typeof className === 'string') {\n            const classes = className.split(/\\s+/);\n            domDesc.push(`.${classes.join('.')}`);\n        }\n    }\n    if (element.name) {\n        domDesc.push(`[name=${element.name}]`);\n    }\n    return domDesc.join('');\n}\n\nexport function querySelector(queryString) {\n    return document.getElementById(queryString) || document.getElementsByName(queryString)[0] || document.querySelector(queryString);\n}\n","import extend from 'extend';\nimport {\n    getEvent,\n    getEventListenerMethod,\n    getBoundingClientRect,\n    stringify,\n    getDomPath,\n} from './utils'\n\nconst DefaultOptions = {\n    useClass: false, \n    per: 0.01,\n    events: ['click'],\n};\n\nclass Tracker {\n    constructor() {\n        this._isInstall = false;\n        this._options = {};\n    }\n\n    config(options = {}) {\n        options = extend(true, {}, DefaultOptions, options);\n        options.event = DefaultOptions.event; \n        this._options = options;\n        return this;\n    }\n\n    _captureEvents() {\n        const self = this;\n        const events = this._options.events;\n        const eventMethodObj = getEventListenerMethod();\n        for (let i = 0, j = events.length; i < j; i++) {\n            let eventName = events[i];\n            document.body[eventMethodObj.addMethod](eventMethodObj.prefix + eventName, function (event) {\n                const eventFix = getEvent(event);\n                if (!eventFix) {\n                    return;\n                }\n                self._handleEvent(eventFix);\n            }, false)\n        }\n    }\n\n    _handleEvent(event) {\n        const per = parseFloat(this._options.per);\n        if (!this.hit(per)) {\n            return;\n        }\n        const domPath = getDomPath(event.target, this._options.useClass);\n        const rect = getBoundingClientRect(event.target);\n        if (rect.width == 0 || rect.height == 0) {\n            return;\n        }\n        let t = document.documentElement || document.body.parentNode;\n        const scrollX = (t && typeof t.scrollLeft == 'number' ? t : document.body).scrollLeft;\n        const scrollY = (t && typeof t.scrollTop == 'number' ? t : document.body).scrollTop;\n        const pageX = event.pageX || event.clientX + scrollX;\n        const pageY = event.pageY || event.clientY + scrollY;\n        const data = {\n            domPath: encodeURIComponent(domPath), \n            trackingType: event.type,\n            offsetX: ((pageX - rect.left - scrollX) / rect.width).toFixed(6), \n            offsetY: ((pageY - rect.top - scrollY) / rect.height).toFixed(6),\n        };\n        this.send(data);\n    }\n\n    send(data = {}) {\n        console.log('data', data);\n        const image = new Image(1, 1);\n        image.onload = function() {\n            image = null;\n        };\n        image.src = `/?${stringify(data)}`;\n    }\n\n    hit(per = 0.01) {\n        return Math.random() < per;\n    }\n\n    install() {\n        if (this._isInstall) {\n            return this;\n        }\n        this._captureEvents();\n        this._isInstall = true;\n        return this;\n    }\n}\n\nexport default Tracker;","import Tracker from './tracker';\n\nconst tracker = new Tracker();\n\nexport default tracker;"],"names":["name","Error","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","isArray","arr","Array","toStr","call","isPlainObject","obj","hasOwnConstructor","hasOwn","hasIsPrototypeOf","constructor","prototype","setProperty","options","value","newValue","getProperty","gOPD","src","copy","copyIsArray","clone","arguments","deep","extend","protoProps","staticProps","hasOwnProperty","toString","getOwnPropertyDescriptor","getDomDesc","element","useClass","domDesc","tagName","id","push","toLowerCase","className","classes","split","join","querySelector","queryString","document","getElementById","getElementsByName","DefaultOptions","per","events","_isInstall","_options","event","this","self","eventMethodObj","addMethod","removeMethod","prefix","window","addEventListener","getEventListenerMethod","j","eventName","body","eventFix","srcElement","currentTarget","_handleEvent","parseFloat","hit","domPath","HTMLElement","console","warn","elem","unshift","indexOf","shift","children","parentNode","getDomPath","rect","getBoundingClientRect","width","right","left","heigth","bottom","top","height","t","documentElement","scrollX","scrollLeft","scrollY","scrollTop","pageX","clientX","pageY","clientY","data","encodeURIComponent","trackingType","type","offsetX","toFixed","offsetY","send","log","image","Image","onload","params","stringify","Math","random","_captureEvents"],"mappings":"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"}